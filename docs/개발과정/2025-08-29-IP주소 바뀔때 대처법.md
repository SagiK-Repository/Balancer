# IP주소 바뀔때 발생한 문제점

## 증상
- `roslaunch motor_controller motor_controller.launch` 명령어를 실행하여 프로젝트를 시작하려 했을 때 화면엔 빈칸만 나오며 실행되지 않았다.
- OS가 멈추지는 않았으며, Ctrl + C를 한번 누르면 명령어가 몇 개 뜨고 만다. Ctrl + C를 한번 더 누르면 shutting down 관련 메시지가 뜨며 roslaunch 명령어가 끝난다.

## 진행한 과정
- 1. IP 주소 관련 문제가 떠올랐고, IP를 조회해보니 전까지 작업하던 주소와 달랐다.
- 2. `개발과정\2025-05-10-프로젝트 생성.md`:168-181 부분에서 IP가 달라서 안되었다는 증상을 확인하였다.
```markdown
/개발과정/2025-05-10-프로젝트 생성.md:168-170

14:19분경 스크린샷 : ip설정 오류떴다.
192.168.0.109를 찾고 있는거 보니깐 IPP설정이 오래됀 것 같아서 out of date인것 같았다.
```

```bash
/개발과정/2025-05-10-프로젝트 생성.md:171-181

tbot3@tbot3-desktop:~/catkin_ws$ echo $ROS_MASTER_URI
http://192.168.0.100:11311
tbot3@tbot3-desktop:~/catkin_ws$ echo $ROS_HOSTNAME

tbot3@tbot3-desktop:~/catkin_ws$ echo $ROS_IP
192.168.0.109
tbot3@tbot3-desktop:~/catkin_ws$
```

- 매크로 설정에 문제가 있다는 것을 알았다.
- 3. ~/.bashrc 파일에서 이런 것들을 설정할 수 있다는 것을 인터넷 검색으로 알았다. ('$ROS_MASTER_URI $ROS_IP 변경법' 구글에 검색, AI요약 활용)
- 4. ~/.bashrc 파일에서 IP를 수동으로 받고 있는 것을 발견함.
```bashrc
~/.bashrc:118-130

alias cm='cd ~/catkin_ws && catkin_make'
alias cs='cd ~/catkin_ws/src'
source /opt/ros/melodic/setup.bash
source ~/catkin_ws/devel/setup.bash
#export ROS_MASTER_URI="http://$(hostname -I | awk '{print $1}'):11311"
#export ROS_IP="$(hostname -I | awk '{print $1}')"
export TURTLEBOT3_MODEL=waffle_pi
export DISPLAY="192.168.0.150:0"
export ROS_MASTER_URI="http://192.168.0.150:11311"
export ROS_IP="192.168.0.150"
export ROS_HOSTNAME="192.168.0.150"
export TURTLEBOT3_IP=$(hostname -I | awk '{print $2}')
source ~/catkin_ws/devel/setup.bash
```
- ~/.bashrc 파일에서 수동으로 IP를 받는 부분을 자동으로 바꾸었다.
- hostname 관련 부분의 설명 : 현재 IP주소를 구하는 `hostname -I` 명령어의 결과 중 하나만 반영되도록 만들었다. hostname 함수의 IP가 여러개일 때를 대비하여 첫번째 것을 뺐다.
```bash
hostname -I
172.30.1.11 172.17.0.1

$(hostname -I | awk '{print $1}')
```
- `$(hostname -I | awk '{print $1}')` 이렇게 적용하면, bashrc에서도 선별된 IP 주소를 사용 가능하다.


## 결론
- 앞으로 IP 주소를 변하게 할 필요가 없도록 `~/.bashrc` 파일을 바꾸었다.
```
alias cm='cd ~/catkin_ws && catkin_make'
alias cs='cd ~/catkin_ws/src'
source /opt/ros/melodic/setup.bash
source ~/catkin_ws/devel/setup.bash
#export ROS_MASTER_URI="http://$(hostname -I | awk '{print $1}'):11311"
#export ROS_IP="$(hostname -I | awk '{print $1}')"
export TURTLEBOT3_MODEL=waffle_pi
export DISPLAY="$(hostname -I | awk '{print $1}'):0"
export ROS_MASTER_URI="http://$(hostname -I | awk '{print $1}'):11311"
export ROS_IP="$(hostname -I | awk '{print $1}')"
export ROS_HOSTNAME="$(hostname -I | awk '{print $1}')"
export TURTLEBOT3_IP=$(hostname -I | awk '{print $1}')
source ~/catkin_ws/devel/setup.bash
```

## 앞으로 신경 쓸 사항 (예상되는 문제)
- hostname -I 명령어에서 실 사용하는 IP가(외부 접속 가능한 IP 등) 첫번째가 아니라면 그 IP를 하려고 bashrc 파일을 수정해서 1번째인지 2번째인지 설정해야 한다.
- 첫번째를 n으로 바꾼다면 `$(hostname -I | awk '{print $1}')` -> `$(hostname -I | awk '{print $n}')`