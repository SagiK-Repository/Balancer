# 2025.05.24 로봇 만들기 프로젝트

- 전원 회로, 브레드보드 등 고정
- 1ch 회로를 2ch로 변환.

- GPIO13

- 74HC156을 넣어 3채널의 입력값을 모두 가져옴.

- SS1 : 바퀴 2
- REV2 : gpio13

- MISO : 래치 출력
- LATCH : 기존 입력 hall sensor 1
# 

# 모터 기능: 바퀴 변위 측정
```
wheel 0 
bit
012
---
001
101
111
110
010
000
001

wheel 1
bit
012
---
110
100
101
001
011
010
```
- 위처럼 바퀴 홀 센서의 신호가 잡혀있다.
- 저 6가지 순서를 바탕으로 바퀴수 및 방향까지 확인할 수 있지 않을까?

- claude에게 물어보니 다 짜줬다.
- 프롬프트 : 
```
모터 드라이버에서 현재 모터의 변위를 측정하려고 해.
3상 모터에서 홀 센서 신호 3개를 가져왔어. 이걸 임의대로 배열하고 그 출력을 바퀴 회전에 빠라 표시했는데, 바퀴0과 1이 각각 다음과 같은 순서로 나왔어.
-위의 로그 메시지-
```

- 결과 : motor_encode.h / motor_encode.cpp
- 여기에 위치 포지셔닝까지! updateRobotOdometry 오도매트리까지 측정해준다.

- 많은 것을 수정했다. 그대로 포팅하니 include 오류, 최대 회전수 제한도 풀고, 홀 센서 인식율을 높이고 효율화하기 위해 이전, 다음 홀 state만 보는 것이 아니라 그 2번 다음, 2번 이전까지 봄으로써 인식가능 최대 속도를 2배 가까이 끌어올렸다.

- 속도계산 함수의 조건도 0.1s 또는 5바퀴 돌아야 데이터가 수집되도록 해서
빠르게 해도 느리게 주행할때도 속도 정확도를 높였다.

# 6축 가속도 자이로 센서 MPU6050
- I2C 연결도 claude에게 맡겼다.
- 프롬프트
```
jetcon nano catkin_ws에서 돌아가는 i2c_controller.cpp와 i2c_controller.h를 만들어줘.
기본 i2c를 사용하고 싶어. c++로 짜주고, SDA, SCL은 각각 3, 5핀이야. 그리고, GY521 기능도 함께 붙여줘.
``` 

- 상세한 라이브러리를 짜주었다.
- 그 예제 코드를 .cpp/.h 2개 파일로 된 클래스로 만들어 기존의 motor_controller 프로젝트에 편입시켰다.
- 코딩이 엄청 순조롭다고 느꼈다.

# 결과물
- 바퀴 수 확인 로직 완료
- 속도 추정 로직 확인 완료
- 가속도 센서 포팅 완료

- `{PROJECT_DIR}/catkin_ws/src/motor_controller/*`에 상세한 내용이 담겨 있다.
