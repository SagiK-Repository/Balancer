# Project Creation

### (~5.8) 설치 방법 Claude에게 질의
- `./2025-05-10-Jetson Nano JetPack 설치 가이드.md` 에다가 사용방법을 물어보고 붙여넣었다.

### (~5.8) Jetson Nano 설치
- ROS 설치여부 확인까지 진행함.
- IP : 192.168.0.150
- ID : tbot3
- PW : *소유자에게 질의*
- 접속 메시지
- ![image](./src/2025-05-10%20213118.png)
- PuTTY를 통해서 연결함.
- ![image](./src/2025-05-10%20213418.png)


### Repository 생성
- https://github.com/SagiK-Repository/balancing_jetson.git


### "git fatal: unable to access" 오류
- 문제점 : 레포지토리를 만들고 clone하려 했지만 git 명령어에서 불가능했다.
- git fork으로 clone 해보려고 했지만 그것도 권한이 없는 것 같아서 안됐다. 
- https://breakcoding.tistory.com/61
- 해결점 : 여기서 한 것처럼 새로 로그인했더니 clone에 성공했다.

### 설치 따라가기
 - tbot3@tbot3-desktop:~$ sudo ufw status
 - sudo: ufw: 명령이 없습니다
 
 - tbot3@tbot3-desktop:~$ jtop
 - -bash: jtop: 명령어를 찾을 수 없음

 - tbot3@tbot3-desktop:~$ nvidia-smi
 - -bash: nvidia-smi: 명령어를 찾을 수 없음

 - tbot3@tbot3-desktop:~$ sysbench cpu --cpu-max-prime=20000 run
 - -bash: sysbench: 명령어를 찾을 수 없음

```
tbot3@tbot3-desktop:~$ sudo apt install jtop nvidia-smi sysbench

패키지 목록을 읽는 중입니다... 완료
의존성 트리를 만드는 중입니다
상태 정보를 읽는 중입니다... 완료
nvidia-smi 패키지를 사용할 수 없습니다.  하지만 다른 패키지가 참조하고 있습니다.
해당 패키지가 누락되었거나 지워졌다는 뜻입니다. 아니면 또 다른 곳에서
패키지를 받아와야 하는 경우일 수도 있습니다.

E: jtop 패키지를 찾을 수 없습니다
E: 'nvidia-smi' 패키지는 설치할 수 있는 후보가 없습니다
```

```
tbot3@tbot3-desktop:~$ sysbench cpu --cpu-max-prime=20000 run
sysbench 1.0.11 (using system LuaJIT 2.1.0-beta3)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Prime numbers limit: 20000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:   466.87

General statistics:
    total time:                          10.0007s
    total number of events:              4671

Latency (ms):
         min:                                  2.13
         avg:                                  2.14
         max:                                  2.67
         95th percentile:                      2.14
         sum:                               9997.31

Threads fairness:
    events (avg/stddev):           4671.0000/0.00
    execution time (avg/stddev):   9.9973/0.00

```

### catkin_make 오류 
```
tbot3@tbot3-desktop:~/catkin_ws$ catkin_make
Base path: /home/tbot3/catkin_ws
......
-- +++ processing catkin package: 'turtlebot3_bringup'
-- ==> add_subdirectory(turtlebot3/turtlebot3_bringup)
-- Could NOT find turtlebot3_msgs (missing: turtlebot3_msgs_DIR)
-- Could not find the required component 'turtlebot3_msgs'. The following CMake error indicates that you either need to install the package with the same name or change your environment so that it can be found.
CMake Error at /opt/ros/melodic/share/catkin/cmake/catkinConfig.cmake:83 (find_package):
  Could not find a package configuration file provided by "turtlebot3_msgs"
  with any of the following names:

    turtlebot3_msgsConfig.cmake
    turtlebot3_msgs-config.cmake

  Add the installation prefix of "turtlebot3_msgs" to CMAKE_PREFIX_PATH or
  set "turtlebot3_msgs_DIR" to a directory containing one of the above files.
  If "turtlebot3_msgs" provides a separate development package or SDK, be
  sure it has been installed.
Call Stack (most recent call first):
  turtlebot3/turtlebot3_bringup/CMakeLists.txt:13 (find_package)


-- Configuring incomplete, errors occurred!
See also "/home/tbot3/catkin_ws/build/CMakeFiles/CMakeOutput.log".
See also "/home/tbot3/catkin_ws/build/CMakeFiles/CMakeError.log".
Makefile:3766: recipe for target 'cmake_check_build_system' failed
make: *** [cmake_check_build_system] Error 1
Invoking "make cmake_check_build_system" failed
```
- 의존성이 빠진 걸로 추정(claude)

- catkin은 다음과 같은 특징이 있다.
1. ROS 통합 빌드 시스템
2. 내부적으로 CMake 사용

- 이거 없이 Cmake 직접 쓰려면, ROS 패키지 구조와 메시지 생성 등의 ROS 특화 기능을 직접 구현해야 하며, ROS의 자동화된 환경 설정 혜택을 받을 수 없다.


tutlebot
Burger, Waffle Pi 2가지 훔종이 있으며,
SLAM(경로 맵화), 네비게이션 등 가능.

- ![image](./src/2025-05-12 124405.png)
- 왜이렇게 오래걸리지??
- 설치 과정이 길다.

- ![image](./src/2025-05-12 125158.png)
- catkin_make 빌드 성공

- ![image](./src/스크린샷%202025-05-12%20125753.png)
- 호스트 연결.


- 그 이후에 F1 + Connect to Host 입력후 아까 넣은 호스트 클릭
- 새 창이 뜨면서 입력가능.
- ![image](./src/스크린샷%202025-05-12%20130041.png)
- 최소 요구사항을 만족하지 못했다고 한다.
- vscode를 직접 설치해 보자.
```
# 서버 안정성을 위해 임시 파일 시스템에 더 많은 공간 할당
sudo mount -o remount,size=1G /dev/shm

# wget을 사용하여 vscode 서버 다운로드 (버전은 로컬 VS Code 버전과 일치해야 함)
wget https://update.code.visualstudio.com/latest/server-linux-arm64/stable -O /tmp/vscode-server-linux-arm64.tar.gz

# 디렉토리 생성 및 압축 해제
mkdir -p ~/.vscode-server/bin
VSCODE_SERVER_VERSION=$(tar tf /tmp/vscode-server-linux-arm64.tar.gz | head -n 1 | cut -d'/' -f1)
mkdir -p ~/.vscode-server/bin/$VSCODE_SERVER_VERSION
tar xf /tmp/vscode-server-linux-arm64.tar.gz -C ~/.vscode-server/bin/$VSCODE_SERVER_VERSION --strip-components 1
touch ~/.vscode-server/bin/$VSCODE_SERVER_VERSION/0
```

### 
2025-05-12-JetsonNano Blink.md 만들고 시작.
gnu nano 환경에서 만들었고, 그대로 따라왔음.

14:19분경 스크린샷 : ip설정 오류떴다.
192.168.0.109를 찾고 있는거 보니깐 IPP설정이 오래됀 것 같아서 out of date인것 같았다.

```

tbot3@tbot3-desktop:~/catkin_ws$ echo $ROS_MASTER_URI
http://192.168.0.100:11311
tbot3@tbot3-desktop:~/catkin_ws$ echo $ROS_HOSTNAME

tbot3@tbot3-desktop:~/catkin_ws$ echo $ROS_IP
192.168.0.109
tbot3@tbot3-desktop:~/catkin_ws$

```

```
started core service [/rosout]
process[led_blink-2]: started with pid [26679]
[ERROR] [1747028681.285468302]: GPIO ?????? ??? ??? ????????????
[led_blink-2] process has finished cleanly
log file: /home/tbot3/.ros/log/31ea098e-2ef4-11f0-abf8-00044be601b3/led_blink-2*.log

```

GPIO jetsion nano 에거 제공하는 라이브러리로 해결하려 한다.
### 4. 권한 문제 해결

```bash
# GPIO 그룹에 사용자 추가
sudo groupadd -f -r gpio
sudo usermod -a -G gpio $USER

# 권한 설정
sudo sh -c 'echo "SUBSYSTEM==\"gpio\", KERNEL==\"gpiochip[0-9]*\", GROUP=\"gpio\", MODE=\"0660\"" > /etc/udev/rules.d/99-gpio.rules'
sudo udevadm control --reload-rules
sudo udevadm trigger

# 시스템 재부팅
sudo reboot
```

### 5. Jetson Nano용 대안 라이브러리 사용

Jetson Nano는 NVIDIA에서 제공하는 특별한 GPIO 라이브러리를 사용하는 것이 좋을 수 있습니다:

```bash
# NVIDIA GPIO 라이브러리 설치
sudo apt-get install -y nvidia-jetpack
```

그리고 코드를 NVIDIA의 GPIO 라이브러리를 사용하도록 수정합니다:

```cpp
#include <ros/ros.h>
#include <JetsonGPIO.h>
#include <unistd.h>
#include <string>

namespace GPIO = Jetson::GPIO;

class LedBlinker {
private:
    ros::NodeHandle nh_;
    ros::NodeHandle private_nh_;
    
    int led_pin_;
    double blink_rate_;
    
public:
    LedBlinker() : private_nh_("~") {
        // 파라미터 로드
        private_nh_.param("led_pin", led_pin_, 18);
        private_nh_.param("blink_rate", blink_rate_, 1.0);
        
        // GPIO 초기화
        GPIO::setmode(GPIO::BOARD);
        GPIO::setup(led_pin_, GPIO::OUT);
        
        ROS_INFO("LED Blink node started: pin=%d, rate=%.1fHz", led_pin_, blink_rate_);
    }
    
    ~LedBlinker() {
        GPIO::cleanup();
        ROS_INFO("GPIO resources cleaned up");
    }
    
    void run() {
        ros::Rate rate(blink_rate_ * 2); // Double for ON/OFF states
        bool value = false;
        
        while (ros::ok()) {
            value = !value;
            GPIO::output(led_pin_, value);
            rate.sleep();
        }
    }
};

int main(int argc, char **argv) {
    ros::init(argc, argv, "led_blink_node");
    
    LedBlinker blinker;
    blinker.run();
    
    return 0;
}
```

### 6. CMakeLists.txt 수정

CMakeLists.txt 파일에 libgpiod 라이브러리가 올바르게 추가되었는지 확인합니다:

```cmake
cmake_minimum_required(VERSION 3.0.2)
project(led_blink)

find_package(catkin REQUIRED COMPONENTS
  roscpp
  std_msgs
)

# 라이브러리 확인
find_library(GPIOD_LIB gpiod)
if(NOT GPIOD_LIB)
  message(FATAL_ERROR "libgpiod not found, please install it")
endif()

catkin_package()

include_directories(
  ${catkin_INCLUDE_DIRS}
)

add_executable(led_blink_node src/led_blink_node.cpp)
target_link_libraries(led_blink_node
  ${catkin_LIBRARIES}
  ${GPIOD_LIB}
)
```



- 영상분석
https://www.youtube.com/watch?v=sB7PSKbTVgw

Hall Signal : 입력 1
PWM Output : 출력 1
STOP Signal : 출력 2


### motor 컨트롤러 만들기

spi 안됨. 왜안됨???
GPIO도 안됨. 왜안됨??
버튼입력만 되는데......
